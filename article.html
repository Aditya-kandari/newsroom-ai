<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Article</title>

  <!-- Analytics look -->
  <link rel="stylesheet" href="css/style2.css">
  <!-- Navbar + cursor -->
  <link rel="stylesheet" href="css/style1.css">
</head>

<body>

<!-- NAVBAR -->
<nav>
  <div class="logo">ðŸ“° Newsroom AI</div>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="articles.html">Articles</a>
    <a href="analytics.html">Analytics</a>
  </div>
</nav>

<main class="analytics-container">

  <!-- ARTICLE -->
  <section class="glass article-section">
    <h1 id="article-title">Loading...</h1>
    <div id="article-content"></div>
  </section>

  <!-- COMMENTS -->
  <section class="glass comments-section">
    <h2>Public Comments</h2>

    <textarea id="comment-input" placeholder="Write your comment..."></textarea>
    <button class="action-btn" onclick="postComment()">Post Comment</button>

    <div id="comments-list"></div>
  </section>

  <!-- AI SUMMARY -->
  <section class="glass summary-section">
    <h2>AI Comment Summary</h2>
    <p id="summary-text" class="collapsed"></p>
    <button class="action-btn small" onclick="loadSummary()">View Summary</button>
  </section>

</main>

<!-- Cursor -->
<script src="js/app1.js" defer></script>

<script defer>
  const params = new URLSearchParams(window.location.search);
  const articleId = params.get("id");

  if (!articleId) {
    console.error("âŒ Article ID missing in URL");
  }

  // Load article
  fetch(`http://127.0.0.1:8000/articles/${articleId}`)
    .then(res => res.json())
    .then(article => {
      console.log("âœ… Article data:", article);

      document.getElementById("article-title").innerText = article.title;

      const contentDiv = document.getElementById("article-content");
      contentDiv.innerHTML = "";

      if (Array.isArray(article.content)) {
        article.content.forEach(paragraph => {
          const p = document.createElement("p");
          p.textContent = paragraph;
          p.style.marginBottom = "16px";
          contentDiv.appendChild(p);
        });
      } else {
        const p = document.createElement("p");
        p.textContent = article.content;
        contentDiv.appendChild(p);
      }
    })
    .catch(err => console.error("âŒ Article fetch failed", err));

  // Load comments
  function loadComments() {
    fetch(`http://127.0.0.1:8000/articles/${articleId}/comments`)
      .then(res => res.json())
      .then(comments => {
        const list = document.getElementById("comments-list");
        list.innerHTML = "";
        comments.forEach(c => {
          const p = document.createElement("p");
          p.innerText = "â€¢ " + c.text;
          list.appendChild(p);
        });
      });
  }

  loadComments();

  // Post comment
  function postComment() {
    const text = document.getElementById("comment-input").value;
    if (!text.trim()) return;

    fetch(`http://127.0.0.1:8000/articles/${articleId}/comments`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    })
    .then(() => {
      document.getElementById("comment-input").value = "";
      loadComments();
    });
  }

  // Load AI summary
  function loadSummary() {
    fetch(`http://127.0.0.1:8000/articles/${articleId}/summary`)
      .then(res => res.json())
      .then(data => {
        document.getElementById("summary-text").innerText = data.summary;
      });
  }
</script>

</body>
</html>